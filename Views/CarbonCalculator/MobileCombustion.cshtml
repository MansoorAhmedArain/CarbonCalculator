@model IEnumerable<WTechAuth.Models.MobileCombustion>

@{
    ViewData["Title"] = "Mobile Combustion";
}

<h2>Step 2: Mobile combustion (Scope -1)</h2>
<h3 style="color:red; font-size: 14px;">
    Enter the average monthly data for your company’s vehicles. The vehicles that are owned by the company are included in this section.
</h3>

<!-- Form Starts Here -->
<form method="post" asp-action="StationaryCombustion">
    <div class="row">
        <div class="container mt-4">
            <!-- Buttons for selecting vehicle category -->
            <div class="row mb-3">
                <div class="col-3">
                    <button id="btn-cars" type="button" class="btn btn-outline-dark w-100 vehicle-btn">Cars</button>
                </div>
                <div class="col-3">
                    <button id="btn-bikes" type="button" class="btn btn-outline-dark w-100 vehicle-btn">Motorbikes</button>
                </div>
                <div class="col-3">
                    <button id="btn-delivery" type="button" class="btn btn-outline-dark w-100 vehicle-btn">Delivery Vans</button>
                </div>
                <div class="col-3">
                    <button id="btn-hgv" type="button" class="btn btn-outline-dark w-100 vehicle-btn">Heavy Goods Vehicles</button>
                </div>
            </div>

            <!-- Input fields for Cars -->
            <div id="cars-fields" class="vehicle-fields d-none">
                <h3>Cars </h3>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="gasolineCount" class="form-label">How many gasoline vehicles?</label>
                        <input type="number" class="form-control" id="gasolineCount" value="0" min="0">
                    </div>
                    <div class="col-md-6">
                        <label for="gasolineDistance" class="form-label">Distance traveled (km) by gasoline vehicles?</label>
                        <input type="number" class="form-control" id="gasolineDistance" value="0" min="0">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="dieselCount" class="form-label">How many diesel vehicles?</label>
                        <input type="number" class="form-control" id="dieselCount" value="0" min="0">
                    </div>
                    <div class="col-md-6">
                        <label for="dieselDistance" class="form-label">Distance traveled (km) by diesel vehicles?</label>
                        <input type="number" class="form-control" id="dieselDistance" value="0" min="0">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="cngCount" class="form-label">How many CNG vehicles?</label>
                        <input type="number" class="form-control" id="cngCount" value="0" min="0">
                    </div>
                    <div class="col-md-6">
                        <label for="cngDistance" class="form-label">Distance traveled (km) by CNG vehicles?</label>
                        <input type="number" class="form-control" id="cngDistance" value="0" min="0">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="hybridCount" class="form-label">How many hybrid vehicles?</label>
                        <input type="number" class="form-control" id="hybridCount" value="0" min="0">
                    </div>
                    <div class="col-md-6">
                        <label for="hybridDistance" class="form-label">Distance traveled (km) by hybrid vehicles?</label>
                        <input type="number" class="form-control" id="hybridDistance" value="0" min="0">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="electricCount" class="form-label">How many electric vehicles?</label>
                        <input type="number" class="form-control" id="electricCount" value="0" min="0">
                    </div>
                    <div class="col-md-6">
                        <label for="electricDistance" class="form-label">Distance traveled (km) by electric vehicles?</label>
                        <input type="number" class="form-control" id="electricDistance" value="0" min="0">
                    </div>
                </div>
            </div>

            <!-- Input fields for Motorbikes -->
            <div id="motorbike-fields" class="vehicle-fields d-none">
                <h3>Motorbikes </h3>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="motorbikeGasolineCount" class="form-label">How many gasoline motorbikes?</label>
                        <input type="number" class="form-control" id="motorbikeGasolineCount" value="0" min="0">
                    </div>
                    <div class="col-md-6">
                        <label for="motorbikeGasolineDistance" class="form-label">Distance traveled (km) by gasoline motorbikes?</label>
                        <input type="number" class="form-control" id="motorbikeGasolineDistance" value="0" min="0">
                    </div>
                </div>
            </div>

            <!-- Input fields for Delivery Vans -->
            <div id="delivery-van-fields" class="vehicle-fields d-none">
                <h3>Delivery Vans </h3>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="deliveryGasolineCount" class="form-label">How many gasoline vans?</label>
                        <input type="number" class="form-control" id="deliveryGasolineCount" value="0" min="0">
                    </div>
                    <div class="col-md-6">
                        <label for="deliveryGasolineDistance" class="form-label">Distance traveled (km) by gasoline vans?</label>
                        <input type="number" class="form-control" id="deliveryGasolineDistance" value="0" min="0">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="deliveryDieselCount" class="form-label">How many diesel vans?</label>
                        <input type="number" class="form-control" id="deliveryDieselCount" value="0" min="0">
                    </div>
                    <div class="col-md-6">
                        <label for="deliveryDieselDistance" class="form-label">Distance traveled (km) by diesel vans?</label>
                        <input type="number" class="form-control" id="deliveryDieselDistance" value="0" min="0">
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="deliveryCngCount" class="form-label">How many CNG vans?</label>
                        <input type="number" class="form-control" id="deliveryCngCount" value="0" min="0">
                    </div>
                    <div class="col-md-6">
                        <label for="deliveryCngDistance" class="form-label">Distance traveled (km) by CNG vans?</label>
                        <input type="number" class="form-control" id="deliveryCngDistance" value="0" min="0">
                    </div>
                </div>
            </div>

            <!-- Input fields for Heavy Goods Vehicles -->
            <div id="hgv-fields" class="vehicle-fields d-none">
                <h3>Heavy Goods Vehicles </h3>
                <div class="row mb-3">
                    <div class="col-md-6">
                        <label for="hgvDieselCount" class="form-label">How many diesel HGVs?</label>
                        <input type="number" class="form-control" id="hgvDieselCount" value="0" min="0">
                    </div>
                    <div class="col-md-6">
                        <label for="hgvDieselDistance" class="form-label">Distance traveled (km) by diesel HGVs?</label>
                        <input type="number" class="form-control" id="hgvDieselDistance" value="0" min="0">
                    </div>
                </div>
            </div>



            <!-- Submit Button -->
            @* <input type="button" value="Calculate Emissions" onclick="calculateTotalEmissions()"> *@

            <div class="d-flex justify-content-center">
                <button type="button" class="btn simple-btn mx-3" onclick="window.location.href='@Url.Action("MobileCombustion", "CarbonCalculator")'">Previous</button>
                <button class="btn simple-btn mx-3" onclick="handleFormSubmit()">Next</button>
            </div>

        </div>
    </div>
</form>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const emissionFactors = {
    @foreach (var factor in Model.Where(f => f.VehicleType == "Cars"))
    {
        <text>
                "@factor.FuelType": @factor.EmissionFactor@((Model.Last() != factor) ? "," : "")
        </text>
    }
            };
    // Add event listeners to toggle visibility for each vehicle category
    document.getElementById('btn-cars').addEventListener('click', function () {
        toggleFields('cars-fields', this);
    });

    document.getElementById('btn-bikes').addEventListener('click', function () {
        toggleFields('motorbike-fields', this);
    });

    document.getElementById('btn-delivery').addEventListener('click', function () {
        toggleFields('delivery-van-fields', this);
    });

    document.getElementById('btn-hgv').addEventListener('click', function () {
        toggleFields('hgv-fields', this);
    });

    // Function to toggle visibility for a selected field group
    function toggleFields(fieldId, btnElement) {
        const field = document.getElementById(fieldId);

        // Toggle visibility of the selected field
        if (field.classList.contains('d-none')) {
            field.classList.remove('d-none');
            btnElement.classList.add('selected');
            btnElement.classList.remove('btn-outline-dark');
            btnElement.classList.add('btn-dark');
        } else {
            field.classList.add('d-none');
            btnElement.classList.remove('selected');
            btnElement.classList.remove('btn-dark');
            btnElement.classList.add('btn-outline-dark');
        }
    }


    // Formulas for calculating emissions "Emissions = Quantity x Emission Factor"

    function calculateEmissions(countId, distanceId, fuelType) {
        const count = parseFloat($('#' + countId).val()) || 0;
        const distance = parseFloat($('#' + distanceId).val()) || 0;
        const emissionFactor = emissionFactors[fuelType.charAt(0).toUpperCase() + fuelType.slice(1).toLowerCase()];
        return count * distance * emissionFactor;
    }

    function calculateTotalEmissions() {
        const gasolineEmissions = calculateEmissions('gasolineCount', 'gasolineDistance', 'Gasoline');
        const dieselEmissions = calculateEmissions('dieselCount', 'dieselDistance', 'Diesel');
        const cngEmissions = calculateEmissions('cngCount', 'cngDistance', 'CNG');
        const hybridEmissions = calculateEmissions('hybridCount', 'hybridDistance', 'Hybrid');
        const electricEmissions = calculateEmissions('electricCount', 'electricDistance', 'Electric');
        sessionStorage.setItem("MobileCombustion", gasolineEmissions + "," + dieselEmissions + "," + cngEmissions + "," + hybridEmissions + "," + electricEmissions);
        console.log('Gasoline Emissions: ', gasolineEmissions);
        console.log('Diesel Emissions: ', dieselEmissions);
        console.log('CNG Emissions: ', cngEmissions);
        console.log('Hybrid Emissions: ', hybridEmissions);
        console.log('Electric Emissions: ', electricEmissions);
    }
    function handleFormSubmit() {
        // Perform emissions calculations
        calculateTotalEmissions();

        // Submit the form after the calculations
        document.querySelector('form').submit();
    }


</script>

